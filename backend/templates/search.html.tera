<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Adbanda Feeder / Search</title>

    <link rel="stylesheet" href="/static/reset.css">
    <link rel="stylesheet" href="/static/style.css">

    <script src="/static/search.js"></script>

    {# player.js requires howler.js #}
    <script src="/static/howler.min.js"></script>
    <script src="/static/player.js"></script>
</head>

<body>
    <main>
        <form id="search-form" method="get" action="/search">
            <fieldset style="display:inline;">
                <legend>ID</legend>
                <input type="text" name="id" id="id" placeholder="Segment ID (Uuid)" size="37"
                    value="{{ result.query.id }}"
                    pattern="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}">
            </fieldset>

            <fieldset style="display:inline;">
                <legend>Artist</legend>
                <input type="text" name="artist" id="artist" placeholder="Artist" size="40"
                    value="{{ result.query.artist }}"><br />
            </fieldset>

            <fieldset style="display:inline;">
                <legend>Title</legend>
                <input type="text" name="title" id="title" placeholder="Title" size="40"
                    value="{{ result.query.title }}"><br />
            </fieldset>

            <fieldset style="display: inline;">
                <legend>Kind</legend>
                {% for kind in ["advertisement", "music", "talk", "unknown"] %}
                <input type="checkbox" name="kind" id="kind-{{kind}}" value="{{kind}}" {% if
                    contains(values=result.query.kind, value=kind) %} checked="checked" {% endif %}>
                <label for="kind-kind">{{kind|title}}</label>
                <br />
                {% endfor %}
            </fieldset>

            <fieldset style="display: inline;">
                <legend>Tags</legend>
                <input type="text" name="tags" id="tags" placeholder="Any tag value" size="40" value="{{ result.query.tags
                    }}"><br />
            </fieldset>

            <fieldset style="display: inline">
                <button type="submit" id="search-button">Search</button>
                <button type="reset" id="reset-button" onclick="reset_form(form);return false;">Reset</button>
            </fieldset>

            <button type="button" id="delete-all"
                onclick="delete_many_items(event, [{% for item in result.items %}'{{ item.id}}',{% endfor %}]);return false;">Delete
                All</button>
        </form>

        <div id="pagination" style="margin: auto;">
            {% if result.total > 0 %}
            {% set first = result.skipped==0 %}
            {% set last = result.skipped >= (result.total - result.limit) %}
            <button type="button" name="first_page" {% if first %} disabled {% endif %}
                onclick="first_page({{result.limit}})">&#x23EE;</button>
            <button type="button" name="prev_page" onclick="prev_page({{result.skipped}}, {{result.limit}})" {% if first
                %} disabled {% endif %}>&#x23F4;</button>
            {{ result.skipped + 1 }} - {{ result.items | length + result.skipped}} / {{ result.total }}
            <button type=" button" name="next_page" onclick="next_page({{result.skipped}}, {{result.limit}})" {% if last
                %} disabled {% endif %}>&#x23F5;</button>
            <button type="button" name="last_page" onclick="last_page({{result.limit}}, {{result.total}})" {% if last %}
                disabled {% endif %}>&#x23ED;</button>
            {% else %}
            No results.
            {% endif %}
        </div>

        <div id="results">
            {% if result.items | length > 0 %}
            <table style="width: 100vw;">
                <thead>
                    <tr>
                        <th onclick="select_all_rows(this);">#</th>
                        <th>ID</th>
                        <th>Artist</th>
                        <th>Title</th>
                        <th>Kind</th>
                        <th>Tags</th>
                        <th># actions #</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in result.items %}
                    <tr>
                        <td>{{ loop.index + result.skipped}}</td>
                        <td style="width: 38ch;">{{ item.id }}</td>
                        <td style="width: 40ch;">{{ item.artist }}</td>
                        <td style="width: 40ch;">{{ item.title }}</td>
                        <td style="width: 14ch;">{{ item.kind }}</td>
                        <td style="width: 100ch; max-width: 100ch;">
                            {% for key, value in item.tags %}
                            <b>{{ key }}</b>: {{ value }}<br />
                            {% endfor %}
                        </td>
                        <td id="actions" style="width: 20ch;">
                            <div class="playbutton" data-media-url="/api/v1/segment/{{ item.id }}/audio"
                                data-play-state="stop" onclick="player_toggle(this)">
                            </div>
                            <br />

                            <button class="copy-button" title="Copy media URL to clipboard"
                                onclick="copy_media_url('/api/v1/segment/{{ item.id }}/audio')"" type=" button">
                                <div class="copy-icon">
                                    <svg width="24" height="25" viewBox="0 0 24 25" xmlns="http://www.w3.org/2000/svg"
                                        alt="Copy media URL to clipboard">
                                        <path
                                            d="M18 20h2v3c0 1-1 2-2 2H2c-.998 0-2-1-2-2V5c0-.911.755-1.667 1.667-1.667h5A3.323 3.323 0 0110 0a3.323 3.323 0 013.333 3.333h5C19.245 3.333 20 4.09 20 5v8.333h-2V9H2v14h16v-3zM3 7h14c0-.911-.793-1.667-1.75-1.667H13.5c-.957 0-1.75-.755-1.75-1.666C11.75 2.755 10.957 2 10 2s-1.75.755-1.75 1.667c0 .911-.793 1.666-1.75 1.666H4.75C3.793 5.333 3 6.09 3 7z">
                                        </path>
                                        <path
                                            d="M4 19h6v2H4zM12 11H4v2h8zM4 17h4v-2H4zM15 15v-3l-4.5 4.5L15 21v-3l8.027-.032L23 15z">
                                        </path>
                                    </svg>
                                </div>
                            </button>

                            <button type="button" name="delete"
                                onclick="return delete_item(event, '{{ item.id }}');">DELETE</button>
                            <br />
                            # edit #
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>
        <div id=" error">{{result.error}}
        </div>
    </main>
</body>
<script type="text/javascript">
    initialize_player();
</script>

</html>
